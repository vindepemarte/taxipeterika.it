"use strict";(()=>{var e={};e.id=605,e.ids=[605],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9167:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9590:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>m,routeModule:()=>w});var n={};r.r(n),r.d(n,{default:()=>f});var a=r(2320),o=r(7799),s=r(9167),i=r(5823),d=r(2969),u=r(3529);let c=require("fs"),l=require("path");async function f(e,t){let r=await Object(function(){var e=Error("Cannot find module 'next-auth/next'");throw e.code="MODULE_NOT_FOUND",e}())(e,t,i.N);return r?.user?.id?"POST"===e.method?await p(e,t,r.user.id):"GET"===e.method?await O(e,t,r.user.id):t.status(405).json({message:"Method not allowed"}):t.status(401).json({message:"Unauthorized"})}async function p(e,t,r){try{let n,a;let{petName:o,species:s,breed:i,sex:f,dateOfBirth:p,colorMarkings:O,microchipNumber:m,petPhotoUrl:h,ownerName:w,ownerAddress:E,ownerPhone:_,ownerEmail:U,emergencyContactName:P,emergencyContactPhone:N,vetName:v,vetPhone:y,medicalConditions:D,allergies:b,currentMedications:j,additionalNotes:g,protectedFields:C,ownerAccessPassword:M,backgroundColor:A}=e.body;if(!o||!s||!w||!_||!U)return t.status(400).json({message:"Missing required fields"});let T=!1;for(;!T;)n=(0,u.bw)(),await d.z.petPass.findUnique({where:{autoGeneratedCode:n}})||(T=!0);M&&(a=await (0,u.hashPassword)(M));let G=await d.z.petPass.create({data:{userId:r,autoGeneratedCode:n,petName:o,species:s,breed:i,sex:f,dateOfBirth:p?new Date(p):null,colorMarkings:O,microchipNumber:m,petPhotoUrl:h,ownerName:w,ownerAddress:E,ownerPhone:_,ownerEmail:U,emergencyContactName:P,emergencyContactPhone:N,vetName:v,vetPhone:y,medicalConditions:D,allergies:b,currentMedications:j,additionalNotes:g,protectedFields:C||[],ownerAccessPasswordHash:a,backgroundColor:A||"#ffffff"}}),F=`${process.env.APP_URL||"http://localhost:3006"}/petpass/${G.autoGeneratedCode}`,L=(0,l.join)(process.cwd(),"public","qrcodes");try{(0,c.mkdirSync)(L,{recursive:!0})}catch(e){}let q=`${G.autoGeneratedCode}.png`,x=(0,l.join)(L,q);await Object(function(){var e=Error("Cannot find module 'qrcode'");throw e.code="MODULE_NOT_FOUND",e}())(x,F,{type:"png",width:300,margin:2}),t.status(201).json({message:"PetPass created successfully",petpass:{id:G.id,autoGeneratedCode:G.autoGeneratedCode,petName:G.petName,url:F,qrCodeUrl:`/qrcodes/${q}`}})}catch(e){console.error("PetPass creation error:",e),t.status(500).json({message:"Internal server error"})}}async function O(e,t,r){try{let e=await d.z.petPass.findMany({where:{userId:r,isActive:!0},select:{id:!0,autoGeneratedCode:!0,petName:!0,species:!0,breed:!0,createdAt:!0,metalTag:{select:{id:!0,status:!0}}},orderBy:{createdAt:"desc"}});t.status(200).json({petpasses:e})}catch(e){console.error("Get user petpasses error:",e),t.status(500).json({message:"Internal server error"})}}(function(){var e=Error("Cannot find module 'next-auth/next'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'qrcode'");throw e.code="MODULE_NOT_FOUND",e}();let m=(0,s.M)(n,"default"),h=(0,s.M)(n,"config"),w=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/petpass",pathname:"/api/petpass",bundlePath:"",filename:""},userland:n})},5823:(e,t,r)=>{r.d(t,{N:()=>a}),function(){var e=Error("Cannot find module 'next-auth/providers/credentials'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@next-auth/prisma-adapter'");throw e.code="MODULE_NOT_FOUND",e}();var n=r(2969);!function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}();let a={adapter:Object(function(){var e=Error("Cannot find module '@next-auth/prisma-adapter'");throw e.code="MODULE_NOT_FOUND",e}())(n.z),providers:[Object(function(){var e=Error("Cannot find module 'next-auth/providers/credentials'");throw e.code="MODULE_NOT_FOUND",e}())({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await n.z.user.findUnique({where:{email:e.email}});return t&&t.password_hash&&await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e.password,t.password_hash)?{id:t.id,email:t.email,name:t.name}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id),e)},pages:{signIn:"/login"}}},2969:(e,t,r)=>{r.d(t,{z:()=>n}),function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}();let n=globalThis.prisma??Object(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}())({log:["query"]})},3529:(e,t,r)=>{r.d(t,{bw:()=>a,hashPassword:()=>o,DT:()=>i,BE:()=>s});let n=require("crypto");function a(){return(0,n.randomBytes)(6).toString("hex").toUpperCase()}async function o(e){return await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e,12)}async function s(e,t){return await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e,t)}function i(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}!function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}()},7799:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},2320:(e,t,r)=>{e.exports=r(5600)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9590);module.exports=r})();