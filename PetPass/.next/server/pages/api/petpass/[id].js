"use strict";(()=>{var e={};e.id=153,e.ids=[153],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9167:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4853:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>p,routeModule:()=>h});var n={};r.r(n),r.d(n,{default:()=>u});var a=r(2320),o=r(7799),s=r(9167),i=r(5823),d=r(2969),c=r(3529);async function u(e,t){let{id:r}=e.query;if("string"!=typeof r)return t.status(400).json({message:"Invalid ID"});if("GET"===e.method)return await l(e,t,r);if("PUT"!==e.method)return t.status(405).json({message:"Method not allowed"});{let n=await Object(function(){var e=Error("Cannot find module 'next-auth/next'");throw e.code="MODULE_NOT_FOUND",e}())(e,t,i.N);return n?.user?.id?await m(e,t,r,n.user.id):t.status(401).json({message:"Unauthorized"})}}async function l(e,t,r){try{let{password:n}=e.query,a=await d.z.petPass.findUnique({where:{autoGeneratedCode:r},include:{user:{select:{id:!0,email:!0}}}});if(!a||!a.isActive)return t.status(404).json({message:"PetPass not found"});let o=!1;n&&a.ownerAccessPasswordHash&&(o=await (0,c.BE)(n,a.ownerAccessPasswordHash));let s=Array.isArray(a.protectedFields)?a.protectedFields:[],i={id:a.id,autoGeneratedCode:a.autoGeneratedCode,backgroundColor:a.backgroundColor,qrCodeUrl:`/qrcodes/${a.autoGeneratedCode}.png`,isOwnerVerified:o,hasProtectedFields:s.length>0,createdAt:a.createdAt},u={petName:a.petName,species:a.species,breed:a.breed,sex:a.sex,dateOfBirth:a.dateOfBirth,colorMarkings:a.colorMarkings,microchipNumber:a.microchipNumber,petPhotoUrl:a.petPhotoUrl,ownerName:a.ownerName,ownerAddress:a.ownerAddress,ownerPhone:a.ownerPhone,ownerEmail:a.ownerEmail,emergencyContactName:a.emergencyContactName,emergencyContactPhone:a.emergencyContactPhone,vetName:a.vetName,vetPhone:a.vetPhone,medicalConditions:a.medicalConditions,allergies:a.allergies,currentMedications:a.currentMedications,additionalNotes:a.additionalNotes};Object.entries(u).forEach(([e,t])=>{s.includes(e)&&!o?i[e]={isProtected:!0,value:null}:i[e]=t}),t.status(200).json(i)}catch(e){console.error("Get PetPass error:",e),t.status(500).json({message:"Internal server error"})}}async function m(e,t,n,a){try{let o=await d.z.petPass.findUnique({where:{autoGeneratedCode:n},select:{id:!0,userId:!0}});if(!o||o.userId!==a)return t.status(403).json({message:"Forbidden"});let s={...e.body};if(delete s.autoGeneratedCode,delete s.userId,s.dateOfBirth&&(s.dateOfBirth=new Date(s.dateOfBirth)),s.ownerAccessPassword){let{hashPassword:e}=await Promise.resolve().then(r.bind(r,3529));s.ownerAccessPasswordHash=await e(s.ownerAccessPassword),delete s.ownerAccessPassword}let i=await d.z.petPass.update({where:{id:o.id},data:s});t.status(200).json({message:"PetPass updated successfully",petpass:{id:i.id,autoGeneratedCode:i.autoGeneratedCode,petName:i.petName}})}catch(e){console.error("Update PetPass error:",e),t.status(500).json({message:"Internal server error"})}}!function(){var e=Error("Cannot find module 'next-auth/next'");throw e.code="MODULE_NOT_FOUND",e}();let p=(0,s.M)(n,"default"),f=(0,s.M)(n,"config"),h=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/petpass/[id]",pathname:"/api/petpass/[id]",bundlePath:"",filename:""},userland:n})},5823:(e,t,r)=>{r.d(t,{N:()=>a}),function(){var e=Error("Cannot find module 'next-auth/providers/credentials'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@next-auth/prisma-adapter'");throw e.code="MODULE_NOT_FOUND",e}();var n=r(2969);!function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}();let a={adapter:Object(function(){var e=Error("Cannot find module '@next-auth/prisma-adapter'");throw e.code="MODULE_NOT_FOUND",e}())(n.z),providers:[Object(function(){var e=Error("Cannot find module 'next-auth/providers/credentials'");throw e.code="MODULE_NOT_FOUND",e}())({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await n.z.user.findUnique({where:{email:e.email}});return t&&t.password_hash&&await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e.password,t.password_hash)?{id:t.id,email:t.email,name:t.name}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id),e)},pages:{signIn:"/login"}}},2969:(e,t,r)=>{r.d(t,{z:()=>n}),function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}();let n=globalThis.prisma??Object(function(){var e=Error("Cannot find module '@prisma/client'");throw e.code="MODULE_NOT_FOUND",e}())({log:["query"]})},3529:(e,t,r)=>{r.d(t,{bw:()=>a,hashPassword:()=>o,DT:()=>i,BE:()=>s});let n=require("crypto");function a(){return(0,n.randomBytes)(6).toString("hex").toUpperCase()}async function o(e){return await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e,12)}async function s(e,t){return await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(e,t)}function i(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}!function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}()},7799:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},2320:(e,t,r)=>{e.exports=r(5600)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4853);module.exports=r})();